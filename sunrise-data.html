<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise & Sunset Data - Sunnyscreen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            -webkit-font-smoothing: antialiased;
            background: linear-gradient(180deg, #000 0%, #1a0a00 50%, #ff6b00 100%);
            color: #f5f5f7;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 48px;
            font-weight: 600;
            margin-bottom: 16px;
            background: linear-gradient(180deg, #fff 0%, #ffb380 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 18px;
            color: #a1a1a6;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 14px;
            color: #c5c5c7;
        }

        input {
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            backdrop-filter: blur(20px);
            min-width: 300px;
        }

        input:focus {
            outline: none;
            border-color: #ff6b00;
        }

        button {
            padding: 12px 32px;
            font-size: 16px;
            font-weight: 500;
            color: #fff;
            background: linear-gradient(180deg, #ff6b00 0%, #ff4500 100%);
            border: none;
            border-radius: 980px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 24px;
        }

        button:hover:not(:disabled) {
            background: linear-gradient(180deg, #ff7a1a 0%, #ff5a1a 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.5);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 12px;
            font-size: 14px;
        }

        .status.loading {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .status.hidden {
            display: none;
        }

        .table-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(255, 107, 0, 0.1);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #ff6b00;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #f5f5f7;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #ff6b00;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #ff7a1a;
        }

        .export-btn {
            padding: 8px 20px;
            font-size: 14px;
            margin-top: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .export-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 10px;
            }

            input {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">← Back to Home</a>

        <header>
            <h1>Sunrise & Sunset Data</h1>
            <p class="subtitle">AI-generated hypothetical sunrise and sunset times for 100 days</p>
        </header>

        <div class="controls">
            <div class="input-group">
                <label for="apiKey">OpenAI API Key</label>
                <input
                    type="password"
                    id="apiKey"
                    placeholder="sk-..."
                    autocomplete="off"
                >
            </div>
            <button id="generateBtn" onclick="generateData()">Generate Data</button>
            <button id="exportBtn" class="export-btn" onclick="exportToCSV()" disabled>Export CSV</button>
        </div>

        <div id="status" class="status hidden"></div>

        <div class="table-container" id="tableContainer" style="display: none;">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Date</th>
                        <th>Sunrise</th>
                        <th>Sunset</th>
                        <th>Daylight Hours</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let generatedData = [];

        // Load API key from localStorage if available
        window.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
        });

        // Save API key to localStorage on blur
        document.addEventListener('DOMContentLoaded', () => {
            const apiKeyInput = document.getElementById('apiKey');
            apiKeyInput.addEventListener('blur', () => {
                const value = apiKeyInput.value.trim();
                if (value) {
                    localStorage.setItem('openai_api_key', value);
                }
            });
        });

        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function hideStatus() {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status hidden';
        }

        function calculateDaylightHours(sunrise, sunset) {
            const [sunriseHour, sunriseMin] = sunrise.split(':').map(Number);
            const [sunsetHour, sunsetMin] = sunset.split(':').map(Number);

            const sunriseMinutes = sunriseHour * 60 + sunriseMin;
            const sunsetMinutes = sunsetHour * 60 + sunsetMin;

            const daylightMinutes = sunsetMinutes - sunriseMinutes;
            const hours = Math.floor(daylightMinutes / 60);
            const minutes = daylightMinutes % 60;

            return `${hours}h ${minutes}m`;
        }

        async function generateData() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                showStatus('Please enter your OpenAI API key', 'error');
                return;
            }

            // Save API key to localStorage
            localStorage.setItem('openai_api_key', apiKey);

            const generateBtn = document.getElementById('generateBtn');
            const exportBtn = document.getElementById('exportBtn');

            generateBtn.disabled = true;
            exportBtn.disabled = true;
            showStatus('Generating data with OpenAI API... This may take a moment.', 'loading');

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful assistant that generates realistic sunrise and sunset data. Generate data that shows natural seasonal variation, with earlier sunrises and later sunsets in summer months, and later sunrises with earlier sunsets in winter months.'
                            },
                            {
                                role: 'user',
                                content: `Generate 100 days of hypothetical sunrise and sunset times starting from January 1, 2025.

For each day, provide:
- Day number (1-100)
- Date (in YYYY-MM-DD format)
- Sunrise time (in HH:MM format, 24-hour)
- Sunset time (in HH:MM format, 24-hour)

Return ONLY a valid JSON array with this exact structure (no markdown, no explanation):
[
  {"day": 1, "date": "2025-01-01", "sunrise": "07:23", "sunset": "16:45"},
  ...
]

Make the times realistic for a mid-latitude location (like 40°N). Show natural seasonal progression with sunrise getting earlier and sunset getting later as we move from winter toward spring.`
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 4000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API request failed');
                }

                const data = await response.json();
                const content = data.choices[0].message.content.trim();

                // Try to parse the content as JSON
                // Remove markdown code blocks if present
                let jsonContent = content;
                if (content.startsWith('```')) {
                    jsonContent = content.replace(/```json?\n?/g, '').replace(/```\n?$/g, '').trim();
                }

                generatedData = JSON.parse(jsonContent);

                if (!Array.isArray(generatedData) || generatedData.length === 0) {
                    throw new Error('Invalid data format received from API');
                }

                displayData(generatedData);
                showStatus(`Successfully generated ${generatedData.length} days of data!`, 'success');
                exportBtn.disabled = false;

                setTimeout(hideStatus, 5000);
            } catch (error) {
                console.error('Error:', error);
                showStatus(`Error: ${error.message}`, 'error');
                generatedData = [];
            } finally {
                generateBtn.disabled = false;
            }
        }

        function displayData(data) {
            const tableBody = document.getElementById('tableBody');
            const tableContainer = document.getElementById('tableContainer');

            tableBody.innerHTML = '';

            data.forEach(row => {
                const tr = document.createElement('tr');
                const daylightHours = calculateDaylightHours(row.sunrise, row.sunset);

                tr.innerHTML = `
                    <td>${row.day}</td>
                    <td>${row.date}</td>
                    <td>${row.sunrise}</td>
                    <td>${row.sunset}</td>
                    <td>${daylightHours}</td>
                `;

                tableBody.appendChild(tr);
            });

            tableContainer.style.display = 'block';
        }

        function exportToCSV() {
            if (generatedData.length === 0) {
                showStatus('No data to export', 'error');
                return;
            }

            // Create CSV content
            const headers = ['Day', 'Date', 'Sunrise', 'Sunset', 'Daylight Hours'];
            const rows = generatedData.map(row => {
                const daylightHours = calculateDaylightHours(row.sunrise, row.sunset);
                return [row.day, row.date, row.sunrise, row.sunset, daylightHours];
            });

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
            ].join('\n');

            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `sunrise-sunset-data-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showStatus('CSV file downloaded successfully!', 'success');
            setTimeout(hideStatus, 3000);
        }

        // Allow Enter key to trigger generation
        document.getElementById('apiKey').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateData();
            }
        });
    </script>
</body>
</html>
